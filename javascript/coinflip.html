<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Coin Flips Experiment</title>
    <meta
      name="description"
      content="Interactive experiment demonstrating how coin flip frequencies converge to 50% as the number of flips increases."
    />
    <link rel="stylesheet" href="/style.css" />
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  </head>

  <body>
    <a href="#main-content" class="skip-link">Skip to main content</a>
    <div class="container">
      <header class="header">
        <h1>Coin Flips Experiment</h1>
        <p>Demonstrating probability convergence through interactive coin flipping</p>
      </header>

      <main id="main-content" class="main-content">
        <nav class="breadcrumbs">
          <a href="/">Home</a>
          <span class="separator">/</span>
          <a href="/javascript/">JavaScript</a>
          <span class="separator">/</span>
          <span class="current">Coin Flips</span>
        </nav>

        <section class="section">
          <p>
            In probability theory, small sample sizes can be misleading. Flip a coin 10 times and
            you might get 30% or 80% heads. But flip it 10,000 times and the frequency will almost
            certainly be very close to 50%.
          </p>

          <p>
            This experiment demonstrates this convergence. It flips coins from 1 to your chosen
            maximum, recording the percentage of heads at each step. The graph shows how the
            frequency approaches 50% as the number of flips increases.
          </p>

          <form id="form" class="form-container">
            <div class="form-group">
              <label for="numSamples">Number of flips to simulate:</label>
              <input
                type="number"
                id="numSamples"
                value="400"
                min="10"
                max="10000"
                class="form-input"
                required
              />
              <small>Simulates 1 to N coin flips (10-10000)</small>
            </div>
            <button type="submit" class="submit-btn">Generate Chart</button>
          </form>

          <div id="error" class="error-message" style="display: none"></div>
          <div style="position: relative; height: 300px; width: 800px; margin-top: 2rem">
            <canvas id="myCanvas"></canvas>
          </div>
        </section>
      </main>
    </div>

    <script>
      "use strict"

      let chart = null

      /**
       * Graphs the visualization given the input from the form.
       */
      function update() {
        const canvas = document.getElementById("myCanvas")
        const numSamples = parseInt(document.getElementById("numSamples").value, 10)
        const errorElement = document.getElementById("error")

        // Clear previous errors.
        errorElement.style.display = "none"

        // Validate input.
        if (isNaN(numSamples) || numSamples < 10 || numSamples > 10000) {
          errorElement.textContent = "Number of samples must be between 10 and 10000"
          errorElement.style.display = "block"
          return
        }

        const frequencies = generateFlipFrequencies(numSamples)

        // Create labels for x-axis (1 to numSamples).
        const labels = Array.from({ length: numSamples }, (_, i) => i + 1)

        // Destroy existing chart if it exists.
        if (chart) {
          chart.destroy()
        }

        // Create new chart.
        chart = new Chart(canvas, {
          type: "line",
          data: {
            labels: labels,
            datasets: [
              {
                label: "Frequency of Heads",
                data: frequencies,
                borderColor: "#8AB87D",
                backgroundColor: "rgba(138, 184, 125, 0.1)",
                borderWidth: 2,
                fill: false,
                tension: 0,
                pointRadius: 0,
                pointHoverRadius: 3,
              },
            ],
          },
          options: {
            responsive: true,
            maintainAspectRatio: false,
            scales: {
              y: {
                beginAtZero: false,
                min: 0.15,
                max: 0.85,
                grid: {
                  color: "rgba(150, 150, 150, 0.3)",
                  drawBorder: false,
                },
                ticks: {
                  callback: function (value) {
                    return (value * 100).toFixed(0) + "%"
                  },
                },
              },
              x: {
                grid: {
                  display: false,
                },
                title: {
                  display: true,
                  text: "Number of Coin Flips",
                },
              },
            },
            plugins: {
              title: {
                display: true,
                text: "Coin Flip Frequency Convergence",
              },
              legend: {
                display: false,
              },
            },
            interaction: {
              intersect: false,
              mode: "index",
            },
          },
        })
      }

      /**
       * Generates frequencies showing how coin flips converge to 0.5.
       *
       * For each number i from 1 to numSampleSets, flips a coin i times and
       * records the proportion of heads. As i increases, this proportion
       * reliably approaches 0.5.
       *
       * @param {number} numSampleSets - Maximum number of flips to simulate.
       * @returns {number[]} Array of head frequencies for each sample size.
       */
      function generateFlipFrequencies(numSampleSets) {
        return Array.from({ length: numSampleSets }, (_, i) => {
          const numFlips = i + 1
          // Math.random() is not exactly like flipping a coin;
          // it returns a number between 0 and 1.
          const sum = Array.from({ length: numFlips }, () => Math.random()).reduce(
            (acc, val) => acc + val,
            0,
          )
          return sum / numFlips
        })
      }

      /**
       * Handles form submission.
       *
       * @param {Event} event - Form submit event.
       */
      function handleSubmit(event) {
        event.preventDefault()
        update()
      }

      // Initialize chart on page load and set up form handler.
      document.addEventListener("DOMContentLoaded", () => {
        update()
        document.getElementById("form").addEventListener("submit", handleSubmit)
      })
    </script>
  </body>
</html>
