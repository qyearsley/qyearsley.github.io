<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>How Long Have You Lived? - Quinten Yearsley</title>
    <meta
      name="description"
      content="Calculate how long you've been alive in various time units."
    />
    <link rel="stylesheet" href="/style.css" />
    <style>
      .results-table {
        width: auto;
        margin: 1rem auto;
      }

      .results-table td {
        padding: 0.5rem 1rem;
      }

      .numeric {
        text-align: right;
        font-weight: 600;
        font-family: monospace;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header class="header">
        <h1>How Long Have You Lived?</h1>
        <p>Calculate the time elapsed since your birth in various units</p>
      </header>

      <main class="main-content">
        <section class="section">
          <form id="form" class="form-container">
            <div class="form-group">
              <label for="dateinput">When were you born?</label>
              <input type="date" id="dateinput" class="form-input" />
            </div>
            <button type="submit" class="submit-btn">Calculate</button>
            <div id="error" class="error-message" style="display: none"></div>
          </form>

          <div id="output" class="output-display" style="display: none">
            <h3>You have now been alive for:</h3>
            <table class="results-table">
              <tr>
                <td class="numeric" id="seconds"></td>
                <td>seconds</td>
              </tr>
              <tr>
                <td class="numeric" id="hours"></td>
                <td>hours</td>
              </tr>
              <tr>
                <td class="numeric" id="days"></td>
                <td>days</td>
              </tr>
              <tr>
                <td class="numeric" id="weeks"></td>
                <td>weeks</td>
              </tr>
            </table>
          </div>
        </section>

        <section class="section">
          <h2>Navigation</h2>
          <ul class="external-links">
            <li><a href="/javascript/">← Back to JavaScript experiments</a></li>
            <li><a href="/">← Back to main page</a></li>
          </ul>
        </section>
      </main>
    </div>

    <script>
      "use strict"

      /**
       * Initializes the counter if a date is specified in the query string.
       * Starts a 1-second interval to continuously update the display.
       */
      function init() {
        const params = new URLSearchParams(window.location.search)
        const dateInput = params.get("date")
        if (!dateInput) {
          return
        }
        document.getElementById("dateinput").value = dateInput
        const date = new Date(dateInput)
        if (date.getTime()) {
          update(date)
          document.getElementById("output").style.display = "block"
          setInterval(() => {
            update(date)
          }, 1000)
        }
      }

      /**
       * Handles form submission.
       * Validates the date and updates the URL with the date parameter.
       *
       * @param {Event} event - Form submit event.
       */
      function handleSubmit(event) {
        event.preventDefault()

        const dateInput = document.getElementById("dateinput").value
        const errorElement = document.getElementById("error")

        if (!dateInput) {
          errorElement.textContent = "Please enter a date."
          errorElement.style.display = "block"
          return
        }

        const date = new Date(dateInput)
        if (date.getTime()) {
          const params = new URLSearchParams(window.location.search)
          params.set("date", dateInput)
          window.location.search = params.toString()
          update(date)
          document.getElementById("output").style.display = "block"
          errorElement.style.display = "none"
        } else {
          errorElement.textContent = "Invalid date."
          errorElement.style.display = "block"
        }
      }

      /**
       * Updates the counter to show elapsed time since the given date.
       *
       * @param {Date} birthday - The birth date to calculate from.
       */
      function update(birthday) {
        const now = new Date()
        const diff = now.getTime() - birthday.getTime()
        const seconds = diff / 1000
        const hours = seconds / 3600
        const days = hours / 24
        const weeks = days / 7

        document.getElementById("seconds").textContent = Math.floor(seconds)
        document.getElementById("hours").textContent = Math.floor(hours)
        document.getElementById("days").textContent = Math.floor(days)
        document.getElementById("weeks").textContent = Math.floor(weeks)
      }

      // Initialize on page load and set up form handler.
      document.addEventListener("DOMContentLoaded", () => {
        init()
        document.getElementById("form").addEventListener("submit", handleSubmit)
      })
    </script>
  </body>
</html>
