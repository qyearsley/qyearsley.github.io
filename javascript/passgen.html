<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Random Password Generator - Quinten Yearsley</title>
    <meta
      name="description"
      content="Generate random passwords using custom character sets defined by JavaScript regular expressions."
    />
    <link rel="stylesheet" href="/style.css" />
    <style>
      /* Page-specific styles only; shared styles are in /style.css */
      .form-input {
        max-width: 300px; /* Narrower than default for this form. */
      }
    </style>
  </head>
  <body>
    <div class="container">
      <header class="header">
        <h1>Random Password Generator</h1>
        <p>Generate secure random passwords with custom character sets</p>
      </header>

      <main class="main-content">
        <section class="section">
          <h2>How It Works</h2>
          <p>
            This password generator creates random strings using JavaScript regular expressions to
            define character sets. You can specify exactly which characters to include, making it
            easy to create passwords that meet specific requirements.
          </p>

          <h2>Generate Password</h2>
          <form id="form" class="form-container">
            <div class="form-group">
              <label for="length">Password Length:</label>
              <input
                id="length"
                type="number"
                min="1"
                max="100"
                value="12"
                class="form-input"
                required
              />
            </div>

            <div class="form-group">
              <label for="regex">Character Set (RegEx):</label>
              <input
                id="regex"
                type="text"
                value="[A-Za-z0-9+=-]"
                class="form-input"
                required
              />
              <small>Use JavaScript regular expressions to define allowed characters</small>
            </div>

            <button type="submit" class="submit-btn">Generate Password</button>
          </form>

          <div id="output" class="output-box"></div>

          <h2>Common Character Sets</h2>
          <div class="examples">
            <div class="example-item">
              <strong>Letters & Numbers:</strong> <code>[A-Za-z0-9]</code>
            </div>
            <div class="example-item"><strong>Lowercase Only:</strong> <code>[a-z]</code></div>
            <div class="example-item"><strong>Uppercase Only:</strong> <code>[A-Z]</code></div>
            <div class="example-item"><strong>Numbers Only:</strong> <code>[0-9]</code></div>
            <div class="example-item">
              <strong>With Special Characters:</strong>
              <code>[A-Za-z0-9!@#$%^&*]</code>
            </div>
            <div class="example-item">
              <strong>Hex Characters:</strong> <code>[0-9A-Fa-f]</code>
            </div>
          </div>
        </section>

        <section class="section">
          <h2>Navigation</h2>
          <ul class="external-links">
            <li><a href="/javascript/">← Back to JavaScript experiments</a></li>
            <li><a href="/">← Back to main page</a></li>
          </ul>
        </section>
      </main>
    </div>

    <script>
      "use strict"

      /**
       * Generates a password and updates the output display.
       */
      function update() {
        const len = parseInt(document.getElementById("length").value, 10)
        const regexInput = document.getElementById("regex").value
        const outputElement = document.getElementById("output")

        // Validate length.
        if (isNaN(len) || len < 1 || len > 100) {
          outputElement.innerHTML =
            '<span style="color: #dc3545;">Error: Length must be between 1 and 100</span>'
          return
        }

        // Validate and create regex.
        let regex
        try {
          regex = new RegExp(regexInput)
        } catch (e) {
          outputElement.innerHTML = `<span style="color: #dc3545;">Error: Invalid regex pattern - ${e.message}</span>`
          return
        }

        const chars = charset(regex)

        if (chars.length === 0) {
          outputElement.innerHTML =
            '<span style="color: #dc3545;">Error: No characters match the regex pattern</span>'
          return
        }

        const password = randomString(len, chars)
        outputElement.innerHTML = `<span style="font-size: 1.5rem; letter-spacing: 2px;">${password}</span>`
      }

      /**
       * Handles form submission.
       *
       * @param {Event} event - Form submit event.
       */
      function handleSubmit(event) {
        event.preventDefault()
        update()
      }

      /**
       * Generates a list of printable ASCII characters that match the given regex.
       *
       * @param {RegExp} regex - Regular expression to test characters against.
       * @returns {string[]} Array of matching characters.
       */
      function charset(regex) {
        const PRINTABLE_ASCII_START = 32
        const PRINTABLE_ASCII_END = 126

        return Array.from({ length: PRINTABLE_ASCII_END - PRINTABLE_ASCII_START + 1 }, (_, i) =>
          String.fromCharCode(PRINTABLE_ASCII_START + i),
        ).filter((char) => regex.test(char))
      }

      /**
       * Generates a random string of given length from the character set.
       *
       * @param {number} length - Desired length of the string.
       * @param {string[]} chars - Array of characters to choose from.
       * @returns {string} Randomly generated string.
       */
      function randomString(length, chars) {
        return Array.from({ length }, () => randomElement(chars)).join("")
      }

      /**
       * Gets a random element from an array.
       *
       * @param {Array} array - Array to select from.
       * @returns {*} Random element from the array.
       */
      function randomElement(array) {
        return array[Math.floor(Math.random() * array.length)]
      }

      // Set up event listeners on page load.
      document.addEventListener("DOMContentLoaded", () => {
        update()
        document.getElementById("form").addEventListener("submit", handleSubmit)
      })
    </script>
  </body>
</html>
